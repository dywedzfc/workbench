(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-59659305"],{4062:function(t,e,a){"use strict";a("d92e")},"43d9":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page",{attrs:{title:"月报",icon:"el-icon-s-home"},on:{back:t.handlePageBack}},[a("panel-query",[a("el-form",{staticClass:"query-form",attrs:{slot:"query-bar",inline:""},slot:"query-bar"},[a("el-form-item",[a("el-input",{attrs:{placeholder:"名称"},model:{value:t.query.name,callback:function(e){t.$set(t.query,"name",e)},expression:"query.name"}})],1),a("el-form-item",[a("picker-year",{model:{value:t.query.year,callback:function(e){t.$set(t.query,"year",e)},expression:"query.year"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleQueryClick}},[t._v("查询")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleTypeClick}},[t._v(t._s(t.taskType))])],1)],1),a("card-list",{attrs:{width:"600px"}},[t.type.state?[t.filterYearList.length?a("card-item",{attrs:{title:t.currentYear}},t._l(t.filterYearList,(function(e,i){return a("task-box",{key:e.id+i,attrs:{data:e,query:t.query.name,loading:t.loading}})})),1):t._e()]:t._l(t.filterMonthlyList,(function(e){return a("card-item",{key:e.date,attrs:{title:e.date}},t._l(e.data,(function(i){return a("task-box",{key:i.id,attrs:{date:e.date,data:i,query:t.query.name,loading:t.loading}})})),1)}))],2)],1)],1)},s=[],l=a("2ef0"),r=a.n(l),n=a("c1df"),o=a.n(n),h=a("2f62"),d=a("7651"),c=a("7f21"),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-date-picker",{staticClass:"query-input_mini",attrs:{type:"year","value-format":"yyyy",placeholder:t.placeholder},model:{value:t.data,callback:function(e){t.data=e},expression:"data"}})},p=[],m={name:"PickerYear",props:{value:{type:String,required:!0},placeholder:{type:String,default:"年份"}},data(){return{loading:!1,data:""}},watch:{value:{handler(t){this.data=t||""},immediate:!0},data:{handler(t){this.$listeners["update:value"]&&this.$emit("update:value",t||""),this.$listeners["input"]&&this.$emit("input",t||"")},immediate:!0}}},k=m,y=a("2877"),v=Object(y["a"])(k,u,p,!1,null,"eccc4d72",null),f=v.exports,g=a("0963"),j=a("bfb7"),C=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-box"},[a("div",{staticClass:"task-title"},[a("el-button",{class:["button-icon",{"not-button":!t.hasJianName}],attrs:{type:"primary",size:"mini"},on:{click:t.handleTitleNameClick}},[t._v(" "+t._s(t.projectButtonText)+" ")]),a("span",{class:{"title-name":t.hasJianName},on:{click:t.handleTitleNameClick}},[t._l(t.titleHighlight(t.projectTitleName),(function(e,i){var s=e.title,l=e.type;return["text"==l?[t._v(t._s(s))]:t._e(),"mark"==l?a("span",{key:i,staticClass:"highlight"},[t._v(t._s(s))]):t._e()]}))],2)],1),a("div",{staticClass:"task-content"},t._l(t.data.task,(function(e,i){return a("p",{key:i,staticClass:"task-word",class:{hover:i===t.task.hover,edit:i===t.task.index},on:{mouseenter:function(e){return t.handleTaskItemMouseenter(i)},mouseleave:t.handleTaskItemMouseleave}},[t._l(t.titleHighlight(e.value),(function(e,i){var s=e.title,l=e.type;return["text"==l?[t._v(t._s(s))]:t._e(),"mark"==l?a("span",{key:i,staticClass:"highlight"},[t._v(t._s(s))]):t._e()]}))],2)})),0),t.monthlyIsNumRecord?a("span",{staticClass:"task-count"},[t._v(t._s(t.data.task.length))]):t._e()])},b=[],T=a("12db"),_=a("4260"),I={name:"TaskBox",props:{data:{type:Object,required:!0},date:{type:String},query:{type:String,default:""},loading:Boolean},data(){return{title:{hover:!1,value:"",edit:!1,remove:!1,type:!1},task:{hover:"",index:"",value:"",edit:!1,remove:!1}}},computed:{...Object(h["b"])({projectList:T["m"],monthlyIsNumRecord:T["j"]}),projectName(){const t=r.a.filter(this.projectList,t=>t.value==this.data.projectId);return t.length>0?t[0].label:""},projectInfo(){const t=r.a.filter(this.projectList,t=>t.value==this.data.projectId);return t.length?t[0]:void 0},projectButtonText(){return this.title.type?"简":"全"},projectTitleName(){const t=this.projectInfo;return t?this.title.type?t.title:t.label:""},projectJianName(){const t=this.projectInfo;return t&&t.title?"简："+t.title:""},projectOptions(){return this.projectList},hasJianName(){const t=this.projectInfo;return!!(t&&t.title&&t.title.trim())}},watch:{loading(t){t||(this.title.edit&&this.handleTitleEditCloseClick(),this.task.edit&&this.handleTaskEditCloseClick())},"title.remove"(t){t||(this.title.hover=!1)},"task.remove"(t){t||(this.task.hover="")}},mounted(){Object(T["J"])(),this.title.type=!!this.hasJianName},methods:{handleTaskTitleMouseenter(){this.title.remove||(this.title.hover=!0)},handleTaskTitleMouseleave(){this.title.remove||(this.title.hover=!1)},handleTitleNameClick(){this.hasJianName&&(this.title.type=!this.title.type)},handleTitleEditClick(){this.title.edit=!0,this.title.value=this.data.projectId,this.task.edit&&this.handleTaskEditCloseClick()},handleTitleEditSubmitClick(){const t={data:r.a.cloneDeep(this.data)};t.query={date:this.date,projectId:this.data.projectId},t.data.projectId=this.title.value,this.$listeners["task-change"]&&this.$emit("task-change",t,t=>200==t&&this.handleTitleEditCloseClick())},handleTitleEditCloseClick(){this.title.value="",this.title.edit=!1},handleTitleDCloseClick(){this.title.remove=!1},handleTitleDSubmitClick(){const t={date:this.date,projectId:this.data.projectId};this.$listeners["title-remove"]&&this.$emit("title-remove",t),this.title.remove=!1},handleTaskItemMouseenter(t){this.task.remove||(this.task.hover=t)},handleTaskItemMouseleave(){this.task.remove||(this.task.hover="")},handleTaskEditClick(t,e){this.task.index=e,this.task.value=t,this.task.edit=!0,this.title.edit&&this.handleTitleEditCloseClick(),this.$nextTick(()=>this.$refs["input_"+e][0].focus())},handleTaskEditSubmitClick(t){const e="|:|",{value:a}=this.task,i=this.data.task.split(e),s={data:r.a.cloneDeep(this.data)};s.data.task=r.a.map(i,e=>e==t?a:e).join(e),s.query={date:this.date,projectId:this.data.projectId},this.$listeners["task-change"]&&this.$emit("task-change",s),this.handleTaskEditCloseClick()},handleTaskEditCloseClick(){this.task.index="",this.task.value="",this.task.edit=!1},handleTaskDCloseClick(){this.task.remove=!1},handleTaskDSubmitClick(t){const e="|:|";this.data.task=r.a.filter(this.data.task.split(e),e=>e!=t).join(e);const a={data:this.data,query:{date:this.date,projectId:this.data.projectId}};this.$listeners["task-change"]&&this.$emit("task-change",a),this.task.remove=!1},titleHighlight(t){const e=this.query.trim()||"";return Object(_["l"])(t,e)}}},q=I,x=(a("4062"),Object(y["a"])(q,C,b,!1,null,"f091e48a",null)),$=x.exports,N={name:"Monthly",components:{Page:d["a"],PanelQuery:c["a"],PickerYear:f,CardList:g["a"],CardItem:j["a"],TaskBox:$},data(){return{loading:!1,query:{name:"",year:""},type:{state:!1,year:""}}},computed:{...Object(h["b"])({projectList:T["m"],monthly:T["i"]}),filterMonthlyList(){const{name:t}=this.query,e=r.a.filter(this.projectList,({label:e,title:a})=>e.includes(t)||a&&a.includes(t)),a=r.a.map(e,"value"),i=JSON.parse(JSON.stringify(this.monthly.month)),s=r.a.map(i,e=>(e.data=r.a.filter(e.data,e=>{const i=a.includes(parseInt(e.projectId)),s=r.a.map(e.task,t=>t.value).join("|:|");let l=!t.includes("|:|")&&s.includes(t);return i||l}),e)),l=r.a.filter(s,t=>t.data.length);return r.a.orderBy(l,"date","desc")},filterYearList(){const{name:t}=this.query,e=r.a.filter(this.projectList,({label:e,title:a})=>e.includes(t)||a&&a.includes(t)),a=r.a.map(e,"value"),i=JSON.parse(JSON.stringify(this.monthly.year)),s=r.a.filter(i,e=>{const i=a.includes(parseInt(e.projectId)),s=r.a.map(e.task,t=>t.value).join("|:|");let l=!t.includes("|:|")&&s.includes(t);return i||l});return r.a.orderBy(s,"date","desc")},currentYear(){return this.type.year||(new Date).getFullYear()},taskType(){return this.type.state?"月":"年"}},watch:{"query.year"(){this.getMonthlyInfo()}},mounted(){this.query.year=o()().format("YYYY"),this.getMonthlyInfo(),Object(T["J"])()},methods:{getMonthlyInfo(){this.loading=!0;const{year:t}=this.query;this.type.year=t||(new Date).getFullYear(),Object(T["H"])(t||"",()=>{this.loading=!1})},handlePageBack(){this.$router.push({name:"Home"})},handleQueryClick(){this.getMonthlyInfo()},handleTypeClick(){this.type.state=!this.type.state}}},E=N,O=Object(y["a"])(E,i,s,!1,null,null,null);e["default"]=O.exports},d92e:function(t,e,a){}}]);