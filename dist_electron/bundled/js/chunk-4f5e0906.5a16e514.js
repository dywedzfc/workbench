(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f5e0906"],{"8ffc":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("page",{attrs:{title:"添加"+e.form.title+"表文件"},on:{back:e.handlePageBack}},[i("div",{staticClass:"template-wrapper"},[i("el-form",{staticClass:"panel-form",attrs:{inline:"","label-width":"80px"}},[i("el-form-item",{attrs:{label:"表名称"}},[i("el-input",{staticClass:"input-block",model:{value:e.form.title,callback:function(t){e.$set(e.form,"title","string"===typeof t?t.trim():t)},expression:"form.title"}})],1),i("el-form-item",{attrs:{label:"文件名称"}},[i("el-input",{staticClass:"input-block",model:{value:e.form.fileName,callback:function(t){e.$set(e.form,"fileName","string"===typeof t?t.trim():t)},expression:"form.fileName"}})],1),i("el-form-item",{attrs:{label:"API地址"}},[i("el-input",{staticClass:"input-block",model:{value:e.form.apiAddress,callback:function(t){e.$set(e.form,"apiAddress",t)},expression:"form.apiAddress"}})],1),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{staticClass:"input-block input-textarea",attrs:{type:"textarea",rows:"3"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),i("el-form-item",{attrs:{label:" "}},[i("el-button",{staticClass:"block",attrs:{type:"primary"},on:{click:e.handleSubmitClick}},[e._v("保存")])],1)],1)],1)])},l=[],s=(i("d9e2"),i("2ef0")),r=i.n(s),o=i("2f62"),m=i("7651"),c=i("12db"),n=i("4260");const{ipcRenderer:f}=window.require("electron");var h={name:"ProjectFileDetails",components:{Page:m["a"]},data(){return{update:!1,type:"",oldFileName:"",form:{title:"",fileName:"",apiAddress:"",remark:""}}},computed:{...Object(o["b"])({projectItem:c["n"],tableFileList:c["u"],tableFileItem:c["v"],tableFileCount:c["p"]})},watch:{tableFileItem:{handler(e){"title"in e||this.$router.push({name:"项目文件"}),this.form=e},deep:!0,immediate:!0}},mounted(){this.tableFileItem.fileName?(this.type="upd",this.oldFileName=this.tableFileItem.fileName):this.type="add"},destroyed(){this.form={title:"",fileName:"",apiAddress:"",remark:""}},methods:{requestSubmitTableFile(){this.tableFileItem.id?Object(c["ib"])(this.form,{fileName:this.projectItem.fileName},({code:e,msg:t})=>{200==e?(Object(n["g"])(t),this.update=!0,this.oldFileName=this.form.fileName,this.$router.push("/jkzsl/file")):Object(n["h"])(t)}):Object(c["B"])(this.form,({code:e,msg:t})=>{200==e?(Object(n["g"])(t),this.update=!0,this.oldFileName=this.form.fileName,this.$router.push("/jkzsl/file")):Object(n["h"])(t)})},handlePageBack(){Object(c["J"])(),Object(c["eb"])(),this.$router.push({name:"项目文件"})},handleSubmitClick(){if(this.verificationTableForm())return;const{title:e}=this.form,t=r.a.filter(this.tableFileList,t=>t.title==e).length;t>1?Object(n["f"])("表名称已重复，是否修改？").then(this.hasRepeatFolder).catch(()=>{}):this.hasRepeatFolder()},initFieldItem({sqlName:e,name:t,defaultValue:i,need:a,comment:l}={}){return{id:this.props.count++,sqlName:e||"",name:t||e||"",defaultValue:i||"",need:0!=a,comment:l||""}},verificationTableForm(){const{title:e}=this.form,{fileName:t}=this.form;if(!e)return Object(n["h"])("请输入表名称"),!0;if(!t)return Object(n["h"])("请输入文件名称"),!0;const i=r.a.filter(this.tableFileList,e=>e.fileName==t).length;return i>1&&(Object(n["h"])("文件名已重复，无法添加！"),!0)},hasRepeatFolder(){const{fileName:e}=this.form,t="table-{fileName}-config.ini".replace("{fileName}",e),i={fileName:t,path:this.projectItem.fileName};f.invoke("has-repeat-folder",i).then(async t=>{"add"==this.type&&300==t.code?this.requestSubmitTableFile():"upd"==this.type?this.oldFileName!=e?300==t.code?this.resetFileName():301==t.code&&Object(n["h"])("表文件已存在，无法修改！"):this.requestSubmitTableFile():"add"==this.type?Object(n["h"])("表文件已存在，无法添加！"):Object(n["h"])("表文件已存在，无法修改！")})},async resetFileName(){try{const e=this.projectItem.fileName,t=n["a"].replace("{fileName}",this.oldFileName),i=n["a"].replace("{fileName}",this.form.fileName),a={oldPath:`${e}/${t}`,newPath:`${e}/${i}`},{code:l}=await f.invoke("rename",a);if(400==l)throw new Error("替换失败");this.requestSubmitTableFile()}catch(e){console.error(e)}}}},d=h,p=(i("db64"),i("2877")),u=Object(p["a"])(d,a,l,!1,null,"4db44f7e",null);t["default"]=u.exports},c8d3:function(e,t,i){},db64:function(e,t,i){"use strict";i("c8d3")}}]);